# Документація Credit Approval App

## Опис проекту

Credit Approval App — це веб-застосунок для прогнозування затвердження кредитних заявок за допомогою машинного навчання. Застосунок дозволяє користувачам подавати заявки на кредит через інтерактивного помічника, а адміністраторам — керувати заявками та аналізувати статистику.

## Документація проекту

Документація проєкту буде доступна після розгортання за адресою:

- **Сторінка документації**: http://127.0.0.1:80/docs/

## Основні можливості

- **Реєстрація та аутентифікація** — система облікових записів користувачів
- **Помічник заявок на кредит** — покроковий переповнення форми з валідацією
- **Прогнозування** — три режими роботи ML моделей
- **Аналітика** — створення графіків та статистики
- **Панель адміністратора** — управління заявками та режимами прогнозування
- **REST API** — серіалайзери для отримання прогнозів

## Вимоги

- Docker та Docker Compose
- Python 3.13+
- PostgreSQL 15+

## Встановлення та запуск

### 1. Клонування репозиторію

```bash
git clone <repository-url>
cd credit-approve-app
```

### 2. Налаштування змінних середовища

Створіть файл `.env` на основі `env.txt`:

```bash
cp env.txt .env
```

Відредагуйте `.env` при необхідності:

```env
SECRET_KEY=your-secret-key-here
DEBUG=False
ALLOWED_HOSTS=127.0.0.1,localhost,yourdomain.com

POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=postgres
POSTGRES_HOST=db
POSTGRES_PORT=5432
```

### 3. Запуск з Docker Compose

```bash
docker-compose up -d
```

Сервіси будуть доступні за адресами:

- **Застосунок**: http://127.0.0.1:80
- **Adminer** (управління БД): http://127.0.0.1:8080

### 4. Ініціалізація бази даних

При першому запуску автоматично:
- Запускаються міграції
- Збираються статичні файли
- Створюється суперкористувач `admin@example.com` / `admin123`

## Архітектура проекту

```
.
├── apps/
│   ├── accounts/          # Аутентифікація користувачів
│   ├── credits/           # Основна функціональність застосунку
│   ├── analytics/         # Аналітика та графіки
│   └── api/               # REST API
├── core/                  # Конфігурація Django
├── ml/                    # ML моделі та утиліти
├── templates/             # HTML шаблони
├── static/                # CSS, JS, зображення
├── nginx/                 # Конфігурація Nginx
└── docker-compose.yml     # Оркестрація контейнерів
```

## Використання застосунку

### Реєстрація та вхід

1. Перейдіть на сторінку реєстрації (`/accounts/register/`)
2. Заповніть форму: email, username, пароль
3. Пароль повинен містити мінімум 8 символів
4. Після реєстрації увійдіть через форму входу

**Облікові дані адміністратора:**
- Email: `admin@example.com`
- Пароль: `admin123`

### Подання заявки на кредит

1. Натисніть **"Get start"** на головній сторінці
2. Пройдіть 11 кроків помічника:
   - Стать
   - Сімейне положення
   - Кількість утримувачів
   - Освіта
   - Зайнятість
   - Дохід заявника
   - Дохід співзаявника
   - Сума кредиту
   - Термін кредиту (в місяцях, до 360)
   - Історія кредиту (тільки в режимі mode1)
   - Тип території (urban/semiurban/rural)

3. Після останнього кроку система видасть результат: затверджено/відхилено

### Перегляд особистих заявок

1. Перейдіть до розділу **"My Credits"** (для звичайних користувачів)
2. Перегляньте список своїх заявок зі статусами та датами

### Панель адміністратора

#### Головна сторінка адміністратора

- Таблиця всіх заявок користувачів
- Фільтрація за періодами (сьогодні, неділя, місяць тощо)
- Змінення та видалення заявок

#### Вибір режиму прогнозування

Три доступні режими:

- **Mode1** — ModelA з історією кредиту (повний набір полів)
- **Mode2** — ModelB без історії кредиту (пропускається крок 10)
- **Mode3** — Ансамбль ModelA+ModelB

Виберіть режим через випадаючого меню та натисніть **"Save"**

#### Створення аналітики

1. Перейдіть до розділу **"Charts"** → **"Create Statistics"**
2. Натисніть **"Create graphics"**
3. Система автоматично створить графіки статистики
4. Графіки будуть доступні в меню **Charts** після створення

### Перегляд графіків

Після створення аналітики:

1. Перейдіть до розділу **"Charts"**
2. Виберіть потрібний графік зі списку
3. Перегляньте візуалізацію

## REST API

### Отримання прогнозу

**URL:** `POST /api/get_predict/`

**Параметри (JSON):**

```json
{
  "gender": "Male",
  "married": "Yes",
  "dependents": 2,
  "education": "Graduate",
  "self_employed": "No",
  "applicant_income": 5000.00,
  "coapplicant_income": 1500.00,
  "loan_amount": 100000.00,
  "loan_amount_term": 360,
  "credit_history": "Yes",
  "property_area": "Urban"
}
```

**Відповідь:**

```json
{
  "prediction": 1
}
```

Де `1` = затверджено, `0` = відхилено

**Примітка:** Поле `credit_history` опціональне в режимі Mode2

## Моделі даних

### User

- `email` — унікальний email
- `username` — унікальне ім'я користувача
- `password` — хешований пароль
- `is_staff` — прапор працівника
- `is_superuser` — прапор адміністратора
- `is_active` — активність облікового запису
- `date_joined` — дата реєстрації

### CreditApplication

- `user` — посилання на User (зовнішній ключ)
- `gender` — стать (Male/Female)
- `married` — сімейне положення (Yes/No)
- `dependents` — кількість утримувачів
- `education` — освіта (Graduate/Not Graduate)
- `self_employed` — самозайнятість (Yes/No)
- `applicant_income` — дохід заявника
- `coapplicant_income` — дохід співзаявника
- `loan_amount` — сума кредиту
- `loan_amount_term` — термін кредиту
- `credit_history` — історія кредиту (1.0/0.0)
- `property_area` — тип території (Urban/Semiurban/Rural)
- `prediction_result` — результат прогнозу (True/False/None)
- `created_at` — дата створення

### PredictionConfig

- `active_mode` — активний режим прогнозування (mode1/mode2/mode3)
- `updated_at` — дата оновлення

### AnalyticGraph

- `name` — унікальне ім'я графіка
- `image_path` — шлях до файлу зображення
- `created_at` — дата створення

## Управління контейнерами

### Запуск сервісів

```bash
docker-compose up -d
```

### Зупинення сервісів

```bash
docker-compose down
```

### Перегляд логів

```bash
docker-compose logs -f web
docker-compose logs -f ml
docker-compose logs -f db
```

### Перебудування образів

```bash
docker-compose build --no-cache
```

### Виконання команд у контейнері

```bash
docker-compose exec web python manage.py shell
docker-compose exec web python manage.py createsuperuser
```

## Структура папок

### `apps/`

- **accounts** — система аутентифікації
- **credits** — основна функціональність заявок
- **analytics** — створення графіків
- **api** — REST API

### `ml/`

- Моделі машинного навчання
- Утиліти для трансформації даних
- Аналіз та створення графіків

### `templates/`

- HTML шаблони для фронтенду
- Розділені за застосунками

### `static/`

- CSS стилі
- JavaScript файли
- Зображення та шрифти

## Безпека

- CSRF захист увімкнено
- XSS фільтр увімкнено
- CORS налаштовано (дозволені всі джерела в dev)
- Паролі хешуються через Django
- Валідація на рівні форм та API

## Проблеми та рішення

### Помилка підключення до БД

Переконайтеся, що контейнер PostgreSQL запущений:

```bash
docker-compose ps
docker-compose up -d db
```

### Статичні файли не завантажуються

Перебудуйте статичні файли:

```bash
docker-compose exec web python manage.py collectstatic --noinput
```

### Міграції не застосовані

Застосуйте міграції вручну:

```bash
docker-compose exec web python manage.py migrate --noinput
```

### Очистка кешу

```bash
docker-compose exec web python manage.py shell
>>> from django.core.cache import cache
>>> cache.clear()
```

## Змінні середовища

| Змінна | Опис | За замовчуванням |
|--------|------|------------------|
| `SECRET_KEY` | Секретний ключ Django | - |
| `DEBUG` | Режим налагодження | False |
| `ALLOWED_HOSTS` | Дозволені хости | localhost |
| `POSTGRES_USER` | Користувач БД | postgres |
| `POSTGRES_PASSWORD` | Пароль БД | postgres |
| `POSTGRES_DB` | Ім'я БД | postgres |
| `POSTGRES_HOST` | Хост БД | db |
| `POSTGRES_PORT` | Порт БД | 5432 |

## Підтримка

У разі виникнення проблем:

1. Перевірте логи контейнерів
2. Переконайтеся в коректності файлу `.env`
3. Перебудуйте контейнери
4. Перевірте наявність вільних портів (80, 5432, 8080)

---

**Версія документації:** 1.0
**Останнє оновлення:** жовтень 2025
